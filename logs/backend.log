
> @smart-trolley/api@1.0.0 dev
> nodemon src/index.js

[33m[nodemon] 3.1.10[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching path(s): *.*[39m
[33m[nodemon] watching extensions: js,mjs,cjs,json[39m
[32m[nodemon] starting `node src/index.js`[39m
[Gemini] Configurado con modelo: gemini-robotics-er-1.5-preview
[Gemini] URL: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] Video stream namespace initialized at /ws

═══════════════════════════════════════════════════════
🚀 Smart Trolley API Server
═══════════════════════════════════════════════════════
✅ Server running on http://localhost:3001
✅ WebSocket available at ws://localhost:3001/ws
✅ Gemini Mode: 🤖 REAL (Production)
✅ Database: 🟢 Connected
═══════════════════════════════════════════════════════

📡 Endpoints:
   GET  /                          - API info
   GET  /health                    - Health check
   GET  /api/trolleys/:id/realtime-status
   GET  /api/trolleys/:id/detections
   GET  /api/scans/:id/summary

🎥 WebSocket Events:
   start_scan  - Iniciar grabación
   frame       - Enviar frame de video
   end_scan    - Finalizar grabación

👀 Listening for connections...

[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (L0Dcsuwdki6oxjLoAAAB)
[WS] User guest disconnected (L0Dcsuwdki6oxjLoAAAB)
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node src/index.js`[39m
[Gemini] Configurado con modelo: gemini-robotics-er-1.5-preview
[Gemini] URL: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] Video stream namespace initialized at /ws

═══════════════════════════════════════════════════════
🚀 Smart Trolley API Server
═══════════════════════════════════════════════════════
✅ Server running on http://localhost:3001
✅ WebSocket available at ws://localhost:3001/ws
✅ Gemini Mode: 🤖 REAL (Production)
✅ Database: 🟢 Connected
═══════════════════════════════════════════════════════

📡 Endpoints:
   GET  /                          - API info
   GET  /health                    - Health check
   GET  /api/trolleys/:id/realtime-status
   GET  /api/trolleys/:id/detections
   GET  /api/scans/:id/summary

🎥 WebSocket Events:
   start_scan  - Iniciar grabación
   frame       - Enviar frame de video
   end_scan    - Finalizar grabación

👀 Listening for connections...

[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (WbTlyfHdp3mW1-I1AAAB)
[WS] Trolley 123 no existe, usando trolley por defecto
[WS] Operator 456 no existe, usando operator por defecto
[WS] Scan 33 started for trolley 1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_4_1761465442770',
  scanType: 'load',
  base64Length: 72796,
  timestamp: 1761465442777
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 0/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 72796
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_5_1761465443293',
  scanType: 'load',
  base64Length: 73804,
  timestamp: 1761465443295
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 1/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73804
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_6_1761465443818',
  scanType: 'load',
  base64Length: 73596,
  timestamp: 1761465443820
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 2/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73596
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_7_1761465444339',
  scanType: 'load',
  base64Length: 73808,
  timestamp: 1761465444341
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 3/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73808
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_8_1761465444865',
  scanType: 'load',
  base64Length: 73732,
  timestamp: 1761465444869
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 4/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73732
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"ZdT9aNXpFZeI6dkPjfGu8Aw"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_9_1761465445397',
  scanType: 'load',
  base64Length: 73932,
  timestamp: 1761465445400
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"ZdT9aKvvK622qtsP1oYS"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 33
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_10_1761465445919',
  scanType: 'load',
  base64Length: 74020,
  timestamp: 1761465445921
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"ZtT9aNicBde2qtsPsMWrCA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 5/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74020
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 6/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73932
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_11_1761465446439',
  scanType: 'load',
  base64Length: 74060,
  timestamp: 1761465446442
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"ZtT9aLXpI7m9qtsPqZuh-A8"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 33
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 7/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74060
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"ZtT9aK-pNqHjqtsPl_atEA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_12_1761465446951',
  scanType: 'load',
  base64Length: 73928,
  timestamp: 1761465446954
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 8/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73928
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_13_1761465447472',
  scanType: 'load',
  base64Length: 74164,
  timestamp: 1761465447475
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Z9T9aO2_J4TwqtsP0pewuAg"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 9/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74164
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Z9T9aL2xOfb_qtsPpuzsCA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_14_1761465447988',
  scanType: 'load',
  base64Length: 74212,
  timestamp: 1761465447990
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 10/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74212
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_15_1761465448505',
  scanType: 'load',
  base64Length: 74080,
  timestamp: 1761465448508
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"aNT9aNaYIvHdqtsP74zkwAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"aNT9aLC_Le2CqtsPi_zIgAk"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 11/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74080
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_16_1761465449020',
  scanType: 'load',
  base64Length: 73712,
  timestamp: 1761465449023
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 12/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73712
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"adT9aPahGaLiqtsPotqF2Ak"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_17_1761465449538',
  scanType: 'load',
  base64Length: 74032,
  timestamp: 1761465449540
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"adT9aIKCMKPnqtsPjcGPuAg"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 13/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74032
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_18_1761465450056',
  scanType: 'load',
  base64Length: 73844,
  timestamp: 1761465450059
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 14/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73844
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"atT9aMfVG9e2qtsPsMWrCA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_19_1761465450589',
  scanType: 'load',
  base64Length: 73812,
  timestamp: 1761465450592
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"atT9aL6hKvv5qtsP_KriCA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 15/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73812
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_20_1761465451103',
  scanType: 'load',
  base64Length: 73860,
  timestamp: 1761465451106
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 16/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73860
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"a9T9aOmCJdbZqtsP34Cc4QE"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_21_1761465451623',
  scanType: 'load',
  base64Length: 74168,
  timestamp: 1761465451625
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 17/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74168
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"a9T9aMKxOpz4qtsPjPa1EA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_22_1761465452155',
  scanType: 'load',
  base64Length: 73476,
  timestamp: 1761465452158
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"bNT9aJLqGbOUmtkPreLu2Qc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 18/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73476
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_23_1761465452672',
  scanType: 'load',
  base64Length: 73876,
  timestamp: 1761465452675
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 19/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73876
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"bdT9aPTgBdL8qtsPr8316Qo"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_24_1761465453188',
  scanType: 'load',
  base64Length: 72332,
  timestamp: 1761465453191
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"bdT9aISQHIniqtsP4J-PuAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 20/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 72332
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_25_1761465453705',
  scanType: 'load',
  base64Length: 71532,
  timestamp: 1761465453707
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 21/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 71532
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"btT9aL7_CqmKqtsP88m0wA8"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_26_1761465454222',
  scanType: 'load',
  base64Length: 67380,
  timestamp: 1761465454225
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"btT9aOqJFd6KmtkPtuq-0Ag"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 22/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 67380
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_27_1761465454739',
  scanType: 'load',
  base64Length: 68256,
  timestamp: 1761465454741
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 23/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 68256
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_28_1761465455256',
  scanType: 'load',
  base64Length: 74820,
  timestamp: 1761465455259
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"b9T9aNaoHqflqtsP9ZCj4AU"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[Gemini] 📥 Response status: 200
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 24/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74820
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"b9T9aLn_ILOUmtkPreLu2Qc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_29_1761465455772',
  scanType: 'load',
  base64Length: 73736,
  timestamp: 1761465455775
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 25/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73736
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"cNT9aJWWA6mKqtsP88m0wA8"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_30_1761465456289',
  scanType: 'load',
  base64Length: 73720,
  timestamp: 1761465456292
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 26/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 73720
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":37,"totalTokenCount":804,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 1/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_31_1761465456806',
  scanType: 'load',
  base64Length: 74228,
  timestamp: 1761465456809
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 33
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":37,"totalTokenCount":804,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 27/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74228
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_32_1761465457338',
  scanType: 'load',
  base64Length: 68404,
  timestamp: 1761465457341
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 28/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 68404
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":37,"totalTokenCount":804,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_33_1761465457871',
  scanType: 'load',
  base64Length: 65808,
  timestamp: 1761465457874
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 29/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 65808
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":37,"totalTokenCount":804,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_34_1761465458386',
  scanType: 'load',
  base64Length: 67664,
  timestamp: 1761465458389
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 30/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 67664
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_35_1761465458905',
  scanType: 'load',
  base64Length: 74420,
  timestamp: 1761465458908
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 31/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74420
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":37,"totalTokenCount":804,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 1/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_36_1761465459417',
  scanType: 'load',
  base64Length: 74920,
  timestamp: 1761465459421
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Takis (confidence: 0.95)
[WS] ✅ Producto 28 marcado como registrado en sesión 33
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 32/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 74920
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":37,"totalTokenCount":804,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_37_1761465459939',
  scanType: 'load',
  base64Length: 75216,
  timestamp: 1761465459942
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 33/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 75216
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_38_1761465460472',
  scanType: 'load',
  base64Length: 75748,
  timestamp: 1761465460475
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 34/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 75748
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_39_1761465460988',
  scanType: 'load',
  base64Length: 75676,
  timestamp: 1761465460991
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 75676
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_40_1761465461506',
  scanType: 'load',
  base64Length: 75360,
  timestamp: 1761465461509
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 36/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 75360
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_41_1761465462021',
  scanType: 'load',
  base64Length: 75432,
  timestamp: 1761465462024
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 37/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 75432
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 33,
  frameId: 'frame_42_1761465462553',
  scanType: 'load',
  base64Length: 75604,
  timestamp: 1761465462556
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 38/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 75604
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 🧹 Tracking limpiado para scan 33 (3 productos únicos registrados)
[WS] Scan 33 ended
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 33
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 2/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 33
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 33
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Takis (confidence: 0.95)
[WS] ✅ Producto 28 marcado como registrado en sesión 33
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Takis (confidence: 0.95)
[WS] ✅ Producto 28 marcado como registrado en sesión 33
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":49,"totalTokenCount":816,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemin
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Takis","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] User guest disconnected (WbTlyfHdp3mW1-I1AAAB)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (f0uOL6uc2Kr42nsNAAAD)
[WS] ⚠️ Trolley 123 no existe, creando return scan sin trolleyId
[WS] ⚠️ Operator 456 no existe, creando return scan sin operatorId
[WS] ✅ Return Scan 5 started for original scan 33
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_45_1761465474467',
  scanType: 'load',
  base64Length: 65096,
  timestamp: 1761465474469
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_46_1761465474986',
  scanType: 'load',
  base64Length: 64968,
  timestamp: 1761465474989
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_47_1761465475513',
  scanType: 'load',
  base64Length: 64428,
  timestamp: 1761465475515
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_48_1761465476041',
  scanType: 'load',
  base64Length: 64920,
  timestamp: 1761465476043
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_49_1761465476564',
  scanType: 'load',
  base64Length: 65140,
  timestamp: 1761465476566
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_50_1761465477085',
  scanType: 'load',
  base64Length: 65744,
  timestamp: 1761465477086
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_51_1761465477613',
  scanType: 'load',
  base64Length: 66376,
  timestamp: 1761465477615
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_52_1761465478147',
  scanType: 'load',
  base64Length: 66276,
  timestamp: 1761465478149
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_53_1761465478672',
  scanType: 'load',
  base64Length: 66456,
  timestamp: 1761465478675
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_54_1761465479197',
  scanType: 'load',
  base64Length: 66552,
  timestamp: 1761465479199
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_55_1761465479713',
  scanType: 'load',
  base64Length: 66380,
  timestamp: 1761465479716
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_56_1761465480241',
  scanType: 'load',
  base64Length: 66164,
  timestamp: 1761465480243
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_57_1761465480764',
  scanType: 'load',
  base64Length: 65964,
  timestamp: 1761465480766
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_58_1761465481292',
  scanType: 'load',
  base64Length: 66332,
  timestamp: 1761465481294
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_59_1761465481819',
  scanType: 'load',
  base64Length: 66232,
  timestamp: 1761465481822
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_60_1761465482347',
  scanType: 'load',
  base64Length: 66092,
  timestamp: 1761465482350
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_61_1761465482875',
  scanType: 'load',
  base64Length: 66264,
  timestamp: 1761465482878
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_62_1761465483402',
  scanType: 'load',
  base64Length: 66160,
  timestamp: 1761465483404
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_63_1761465483930',
  scanType: 'load',
  base64Length: 65980,
  timestamp: 1761465483933
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_64_1761465484458',
  scanType: 'load',
  base64Length: 65784,
  timestamp: 1761465484460
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_65_1761465484980',
  scanType: 'load',
  base64Length: 65924,
  timestamp: 1761465484983
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_66_1761465485507',
  scanType: 'load',
  base64Length: 66024,
  timestamp: 1761465485510
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_67_1761465486035',
  scanType: 'load',
  base64Length: 66188,
  timestamp: 1761465486038
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_68_1761465486563',
  scanType: 'load',
  base64Length: 65848,
  timestamp: 1761465486566
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_69_1761465487084',
  scanType: 'load',
  base64Length: 65720,
  timestamp: 1761465487086
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_70_1761465487614',
  scanType: 'load',
  base64Length: 65924,
  timestamp: 1761465487616
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_71_1761465488143',
  scanType: 'load',
  base64Length: 64788,
  timestamp: 1761465488146
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_72_1761465488669',
  scanType: 'load',
  base64Length: 63692,
  timestamp: 1761465488671
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_73_1761465489192',
  scanType: 'load',
  base64Length: 64500,
  timestamp: 1761465489194
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_74_1761465489719',
  scanType: 'load',
  base64Length: 65388,
  timestamp: 1761465489721
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_75_1761465490246',
  scanType: 'load',
  base64Length: 65380,
  timestamp: 1761465490249
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_76_1761465490773',
  scanType: 'load',
  base64Length: 60532,
  timestamp: 1761465490776
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_77_1761465491297',
  scanType: 'load',
  base64Length: 28712,
  timestamp: 1761465491299
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_78_1761465491823',
  scanType: 'load',
  base64Length: 28652,
  timestamp: 1761465491825
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_79_1761465492348',
  scanType: 'load',
  base64Length: 29004,
  timestamp: 1761465492349
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_80_1761465492870',
  scanType: 'load',
  base64Length: 28924,
  timestamp: 1761465492872
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_81_1761465493396',
  scanType: 'load',
  base64Length: 52280,
  timestamp: 1761465493398
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_82_1761465493932',
  scanType: 'load',
  base64Length: 67188,
  timestamp: 1761465493934
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_83_1761465494457',
  scanType: 'load',
  base64Length: 67500,
  timestamp: 1761465494460
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_84_1761465494986',
  scanType: 'load',
  base64Length: 68556,
  timestamp: 1761465494988
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_85_1761465495513',
  scanType: 'load',
  base64Length: 68684,
  timestamp: 1761465495515
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_86_1761465496046',
  scanType: 'load',
  base64Length: 67608,
  timestamp: 1761465496049
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_87_1761465496574',
  scanType: 'load',
  base64Length: 67812,
  timestamp: 1761465496576
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_88_1761465497103',
  scanType: 'load',
  base64Length: 68388,
  timestamp: 1761465497105
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_89_1761465497630',
  scanType: 'load',
  base64Length: 68488,
  timestamp: 1761465497633
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_90_1761465498160',
  scanType: 'load',
  base64Length: 68580,
  timestamp: 1761465498162
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_91_1761465498689',
  scanType: 'load',
  base64Length: 68240,
  timestamp: 1761465498692
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_92_1761465499211',
  scanType: 'load',
  base64Length: 68392,
  timestamp: 1761465499212
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 🧹 Tracking limpiado para scan 5 (0 productos únicos registrados)
[WS] ✅ Return Scan 5 ended
[WS] User guest disconnected (f0uOL6uc2Kr42nsNAAAD)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (-95wJwuVyG8IW-HRAAAF)
[WS] Return scan already exists, usando existente: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_94_1761465567031',
  scanType: 'load',
  base64Length: 48636,
  timestamp: 1761465567032
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_95_1761465567554',
  scanType: 'load',
  base64Length: 58396,
  timestamp: 1761465567557
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_96_1761465568071',
  scanType: 'load',
  base64Length: 59496,
  timestamp: 1761465568074
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_97_1761465568586',
  scanType: 'load',
  base64Length: 64596,
  timestamp: 1761465568589
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_98_1761465569103',
  scanType: 'load',
  base64Length: 65772,
  timestamp: 1761465569105
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_99_1761465569621',
  scanType: 'load',
  base64Length: 66584,
  timestamp: 1761465569624
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_100_1761465570153',
  scanType: 'load',
  base64Length: 64664,
  timestamp: 1761465570156
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_101_1761465570672',
  scanType: 'load',
  base64Length: 67596,
  timestamp: 1761465570674
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_102_1761465571187',
  scanType: 'load',
  base64Length: 66888,
  timestamp: 1761465571190
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_103_1761465571705',
  scanType: 'load',
  base64Length: 68408,
  timestamp: 1761465571707
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_104_1761465572221',
  scanType: 'load',
  base64Length: 67852,
  timestamp: 1761465572224
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_105_1761465572738',
  scanType: 'load',
  base64Length: 64956,
  timestamp: 1761465572741
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_106_1761465573271',
  scanType: 'load',
  base64Length: 63756,
  timestamp: 1761465573273
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_107_1761465573788',
  scanType: 'load',
  base64Length: 64248,
  timestamp: 1761465573790
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_108_1761465574304',
  scanType: 'load',
  base64Length: 64904,
  timestamp: 1761465574307
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_109_1761465574820',
  scanType: 'load',
  base64Length: 65296,
  timestamp: 1761465574823
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_110_1761465575338',
  scanType: 'load',
  base64Length: 65764,
  timestamp: 1761465575341
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_111_1761465575855',
  scanType: 'load',
  base64Length: 65596,
  timestamp: 1761465575857
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_112_1761465576388',
  scanType: 'load',
  base64Length: 65436,
  timestamp: 1761465576391
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_113_1761465576920',
  scanType: 'load',
  base64Length: 64920,
  timestamp: 1761465576923
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_114_1761465577437',
  scanType: 'load',
  base64Length: 65132,
  timestamp: 1761465577440
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_115_1761465577972',
  scanType: 'load',
  base64Length: 69664,
  timestamp: 1761465577974
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_116_1761465578488',
  scanType: 'load',
  base64Length: 68896,
  timestamp: 1761465578491
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_117_1761465579002',
  scanType: 'load',
  base64Length: 67768,
  timestamp: 1761465579004
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_118_1761465579520',
  scanType: 'load',
  base64Length: 69504,
  timestamp: 1761465579522
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_119_1761465580034',
  scanType: 'load',
  base64Length: 70312,
  timestamp: 1761465580036
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_120_1761465580554',
  scanType: 'load',
  base64Length: 70852,
  timestamp: 1761465580555
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 5,
  frameId: 'frame_121_1761465581069',
  scanType: 'load',
  base64Length: 70108,
  timestamp: 1761465581072
}
[WS] ❌ Invalid or ended load scan: 5
[WS] 🧹 Tracking limpiado para scan 5 (0 productos únicos registrados)
[WS] ✅ Return Scan 5 ended
[WS] Error ending scan: PrismaClientKnownRequestError: 
Invalid `prisma.scan.update()` invocation in
/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/apps/api/routes/videoStream.js:461:43

  458 try {
  459   const { scanId } = payload;
  460 
→ 461   const updated = await prisma.scan.update(
An operation failed because it depends on one or more records that were required but not found. Record to update not found.
    at $n.handleRequestError (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/generated/prisma/runtime/library.js:121:7315)
    at $n.handleAndLogRequestError (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/generated/prisma/runtime/library.js:121:6623)
    at $n.request (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/generated/prisma/runtime/library.js:121:6307)
    at async l (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/generated/prisma/runtime/library.js:130:9633)
    at async Socket.<anonymous> (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/apps/api/routes/videoStream.js:461:25) {
  code: 'P2025',
  clientVersion: '5.22.0',
  meta: { modelName: 'Scan', cause: 'Record to update not found.' }
}
[WS] User guest disconnected (-95wJwuVyG8IW-HRAAAF)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (enPDx5DzEdaiE8C2AAAH)
[WS] Trolley 123 no existe, usando trolley por defecto
[WS] Operator 456 no existe, usando operator por defecto
[WS] Scan 34 started for trolley 1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_3_1761466161921',
  scanType: 'load',
  base64Length: 66984,
  timestamp: 1761466161924
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 0/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66984
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_4_1761466162445',
  scanType: 'load',
  base64Length: 68084,
  timestamp: 1761466162448
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 1/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 68084
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_5_1761466162970',
  scanType: 'load',
  base64Length: 68512,
  timestamp: 1761466162972
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 2/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 68512
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_6_1761466163493',
  scanType: 'load',
  base64Length: 69200,
  timestamp: 1761466163496
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 3/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 69200
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_7_1761466164015',
  scanType: 'load',
  base64Length: 69268,
  timestamp: 1761466164017
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 4/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 69268
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_8_1761466164538',
  scanType: 'load',
  base64Length: 63996,
  timestamp: 1761466164540
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 5/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 63996
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_9_1761466165059',
  scanType: 'load',
  base64Length: 65516,
  timestamp: 1761466165061
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 34
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 2/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_10_1761466165582',
  scanType: 'load',
  base64Length: 65660,
  timestamp: 1761466165584
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 34
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 34
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 34
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 6/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 65516
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 34
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_11_1761466166117',
  scanType: 'load',
  base64Length: 66768,
  timestamp: 1761466166119
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 7/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66768
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 34
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 34
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 8/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 65660
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_12_1761466166632',
  scanType: 'load',
  base64Length: 68152,
  timestamp: 1761466166633
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 34
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 9/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 68152
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_13_1761466167163',
  scanType: 'load',
  base64Length: 69360,
  timestamp: 1761466167165
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 10/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 69360
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 34,
  frameId: 'frame_14_1761466167683',
  scanType: 'load',
  base64Length: 69408,
  timestamp: 1761466167686
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 11/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 69408
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 🧹 Tracking limpiado para scan 34 (3 productos únicos registrados)
[WS] Scan 34 ended
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 34
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 2/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 34
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 34
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 34
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 34
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 34
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 34
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 34
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] User guest disconnected (enPDx5DzEdaiE8C2AAAH)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (cxMy92kPLYNzhU__AAAJ)
[WS] ⚠️ Trolley 123 no existe, creando return scan sin trolleyId
[WS] ⚠️ Operator 456 no existe, creando return scan sin operatorId
[WS] ✅ Return Scan 6 started for original scan 34
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_17_1761466187665',
  scanType: 'load',
  base64Length: 36924,
  timestamp: 1761466187668
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_18_1761466188191',
  scanType: 'load',
  base64Length: 36800,
  timestamp: 1761466188193
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_19_1761466188719',
  scanType: 'load',
  base64Length: 37104,
  timestamp: 1761466188721
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_20_1761466189245',
  scanType: 'load',
  base64Length: 37000,
  timestamp: 1761466189246
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_21_1761466189766',
  scanType: 'load',
  base64Length: 36812,
  timestamp: 1761466189767
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_22_1761466190291',
  scanType: 'load',
  base64Length: 36808,
  timestamp: 1761466190293
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_23_1761466190817',
  scanType: 'load',
  base64Length: 36636,
  timestamp: 1761466190819
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_24_1761466191340',
  scanType: 'load',
  base64Length: 36764,
  timestamp: 1761466191342
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_25_1761466191865',
  scanType: 'load',
  base64Length: 36748,
  timestamp: 1761466191867
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_26_1761466192391',
  scanType: 'load',
  base64Length: 35264,
  timestamp: 1761466192393
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_27_1761466192924',
  scanType: 'load',
  base64Length: 35736,
  timestamp: 1761466192926
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_28_1761466193450',
  scanType: 'load',
  base64Length: 34204,
  timestamp: 1761466193452
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_29_1761466193976',
  scanType: 'load',
  base64Length: 35172,
  timestamp: 1761466193977
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_30_1761466194497',
  scanType: 'load',
  base64Length: 34048,
  timestamp: 1761466194498
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_31_1761466195015',
  scanType: 'load',
  base64Length: 35416,
  timestamp: 1761466195016
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_32_1761466195540',
  scanType: 'load',
  base64Length: 35400,
  timestamp: 1761466195541
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_33_1761466196066',
  scanType: 'load',
  base64Length: 36000,
  timestamp: 1761466196068
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_34_1761466196590',
  scanType: 'load',
  base64Length: 36384,
  timestamp: 1761466196592
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_35_1761466197107',
  scanType: 'load',
  base64Length: 37268,
  timestamp: 1761466197108
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_36_1761466197639',
  scanType: 'load',
  base64Length: 37164,
  timestamp: 1761466197641
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_37_1761466198166',
  scanType: 'load',
  base64Length: 37804,
  timestamp: 1761466198168
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_38_1761466198691',
  scanType: 'load',
  base64Length: 38264,
  timestamp: 1761466198693
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_39_1761466199217',
  scanType: 'load',
  base64Length: 37924,
  timestamp: 1761466199219
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_40_1761466199746',
  scanType: 'load',
  base64Length: 38444,
  timestamp: 1761466199748
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_41_1761466200273',
  scanType: 'load',
  base64Length: 37764,
  timestamp: 1761466200275
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_42_1761466200800',
  scanType: 'load',
  base64Length: 38504,
  timestamp: 1761466200802
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_43_1761466201327',
  scanType: 'load',
  base64Length: 38892,
  timestamp: 1761466201329
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_44_1761466201856',
  scanType: 'load',
  base64Length: 37736,
  timestamp: 1761466201858
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_45_1761466202383',
  scanType: 'load',
  base64Length: 38428,
  timestamp: 1761466202385
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_46_1761466202901',
  scanType: 'load',
  base64Length: 36952,
  timestamp: 1761466202902
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_47_1761466203425',
  scanType: 'load',
  base64Length: 37528,
  timestamp: 1761466203427
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_48_1761466203956',
  scanType: 'load',
  base64Length: 36792,
  timestamp: 1761466203958
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_49_1761466204479',
  scanType: 'load',
  base64Length: 37496,
  timestamp: 1761466204481
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_50_1761466205002',
  scanType: 'load',
  base64Length: 37588,
  timestamp: 1761466205004
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_51_1761466205525',
  scanType: 'load',
  base64Length: 37644,
  timestamp: 1761466205526
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_52_1761466206054',
  scanType: 'load',
  base64Length: 38200,
  timestamp: 1761466206056
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_53_1761466206581',
  scanType: 'load',
  base64Length: 37984,
  timestamp: 1761466206582
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_54_1761466207104',
  scanType: 'load',
  base64Length: 38100,
  timestamp: 1761466207106
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_55_1761466207631',
  scanType: 'load',
  base64Length: 38404,
  timestamp: 1761466207633
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_56_1761466208156',
  scanType: 'load',
  base64Length: 38492,
  timestamp: 1761466208158
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_57_1761466208674',
  scanType: 'load',
  base64Length: 38548,
  timestamp: 1761466208676
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_58_1761466209197',
  scanType: 'load',
  base64Length: 38552,
  timestamp: 1761466209199
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_59_1761466209722',
  scanType: 'load',
  base64Length: 38076,
  timestamp: 1761466209724
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_60_1761466210249',
  scanType: 'load',
  base64Length: 38612,
  timestamp: 1761466210251
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_61_1761466210788',
  scanType: 'load',
  base64Length: 38412,
  timestamp: 1761466210790
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_62_1761466211313',
  scanType: 'load',
  base64Length: 37776,
  timestamp: 1761466211315
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 6,
  frameId: 'frame_63_1761466211839',
  scanType: 'load',
  base64Length: 36144,
  timestamp: 1761466211841
}
[WS] ❌ Invalid or ended load scan: 6
[WS] 🧹 Tracking limpiado para scan 6 (0 productos únicos registrados)
[WS] ✅ Return Scan 6 ended
[WS] Error ending scan: PrismaClientKnownRequestError: 
Invalid `prisma.scan.update()` invocation in
/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/apps/api/routes/videoStream.js:461:43

  458 try {
  459   const { scanId } = payload;
  460 
→ 461   const updated = await prisma.scan.update(
An operation failed because it depends on one or more records that were required but not found. Record to update not found.
    at $n.handleRequestError (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/generated/prisma/runtime/library.js:121:7315)
    at $n.handleAndLogRequestError (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/generated/prisma/runtime/library.js:121:6623)
    at $n.request (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/generated/prisma/runtime/library.js:121:6307)
    at async l (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/generated/prisma/runtime/library.js:130:9633)
    at async Socket.<anonymous> (/Users/patriciogarza/Desktop/repos/GateGroup_HackMTY/apps/api/routes/videoStream.js:461:25) {
  code: 'P2025',
  clientVersion: '5.22.0',
  meta: { modelName: 'Scan', cause: 'Record to update not found.' }
}
[WS] User guest disconnected (cxMy92kPLYNzhU__AAAJ)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (Jav_KvocSnICc73sAAAL)
[WS] Trolley 123 no existe, usando trolley por defecto
[WS] Operator 456 no existe, usando operator por defecto
[WS] Scan 35 started for trolley 1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_4_1761466552301',
  scanType: 'load',
  base64Length: 79068,
  timestamp: 1761466552305
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 0/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79068
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_5_1761466552836',
  scanType: 'load',
  base64Length: 79104,
  timestamp: 1761466552839
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 1/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79104
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_6_1761466553363',
  scanType: 'load',
  base64Length: 79216,
  timestamp: 1761466553366
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 2/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79216
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_7_1761466553889',
  scanType: 'load',
  base64Length: 79144,
  timestamp: 1761466553891
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 3/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79144
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_8_1761466554412',
  scanType: 'load',
  base64Length: 79188,
  timestamp: 1761466554413
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 4/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79188
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_9_1761466554940',
  scanType: 'load',
  base64Length: 79292,
  timestamp: 1761466554942
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 5/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79292
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_10_1761466555468',
  scanType: 'load',
  base64Length: 79284,
  timestamp: 1761466555471
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 35
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 2/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_11_1761466555999',
  scanType: 'load',
  base64Length: 79212,
  timestamp: 1761466556001
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 35
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 35
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 1/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 6/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79284
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_12_1761466556522',
  scanType: 'load',
  base64Length: 79092,
  timestamp: 1761466556524
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 35
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 35
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 7/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79092
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 35
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 8/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79212
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_13_1761466557040',
  scanType: 'load',
  base64Length: 79044,
  timestamp: 1761466557041
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 35
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 9/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79044
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 35
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 35
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_14_1761466557558',
  scanType: 'load',
  base64Length: 78872,
  timestamp: 1761466557561
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 10/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 78872
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_15_1761466558075',
  scanType: 'load',
  base64Length: 78648,
  timestamp: 1761466558078
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 11/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 78648
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_16_1761466558593',
  scanType: 'load',
  base64Length: 78776,
  timestamp: 1761466558597
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 12/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 78776
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.9},{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.9}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.9},{"name":"Doritos Nacho","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.9}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.9},{"name":"Doritos Nacho","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.9}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.9 },
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.9 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.9 },
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.9 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_17_1761466559108',
  scanType: 'load',
  base64Length: 78900,
  timestamp: 1761466559111
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 13/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 78900
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_18_1761466559627',
  scanType: 'load',
  base64Length: 79064,
  timestamp: 1761466559630
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 14/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79064
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 35,
  frameId: 'frame_19_1761466560142',
  scanType: 'load',
  base64Length: 79120,
  timestamp: 1761466560145
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 15/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79120
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 🧹 Tracking limpiado para scan 35 (3 productos únicos registrados)
[WS] Scan 35 ended
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 35
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 35
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 1/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 35
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 35
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] User guest disconnected (Jav_KvocSnICc73sAAAL)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (mVQr44634RGwh_2tAAAN)
[WS] ⚠️ Trolley 123 no existe, creando return scan sin trolleyId
[WS] ⚠️ Operator 456 no existe, creando return scan sin operatorId
[WS] ✅ Return Scan 7 started for original scan 35
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_22_1761466572007',
  scanType: 'return',
  base64Length: 38108,
  timestamp: 1761466572010
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 16/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38108
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_23_1761466572534',
  scanType: 'return',
  base64Length: 37876,
  timestamp: 1761466572536
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 17/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 37876
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_24_1761466573055',
  scanType: 'return',
  base64Length: 37828,
  timestamp: 1761466573057
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 18/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 37828
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_25_1761466573582',
  scanType: 'return',
  base64Length: 38028,
  timestamp: 1761466573584
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 19/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38028
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_26_1761466574105',
  scanType: 'return',
  base64Length: 38024,
  timestamp: 1761466574107
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"ztj9aIidCvyMqtsPyPGH4AE"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 20/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38024
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_27_1761466574633',
  scanType: 'return',
  base64Length: 38056,
  timestamp: 1761466574635
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"ztj9aK3ELfyMqtsPyPGH4AE"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] ✅ [RETURN] Producto registrado: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 7
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 21/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38056
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_28_1761466575167',
  scanType: 'return',
  base64Length: 38104,
  timestamp: 1761466575168
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"z9j9aOj_E__4qtsPt5OXsAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ [RETURN] Producto registrado: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 7
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 22/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38104
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_29_1761466575694',
  scanType: 'return',
  base64Length: 38108,
  timestamp: 1761466575696
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"z9j9aK3gM62AmtkP-YqiCA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 23/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38108
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"z9j9aMbgPKLiqtsPotqF2Ak"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_30_1761466576218',
  scanType: 'return',
  base64Length: 37788,
  timestamp: 1761466576220
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"0Nj9aLygErivmtkPoNSR-Qc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 24/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 37788
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_31_1761466576744',
  scanType: 'return',
  base64Length: 37944,
  timestamp: 1761466576747
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"0Nj9aMGtLunlqtsPvrWH2AQ"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 25/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 37944
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"0dj9aJXGC_2CmtkPy-uZqAg"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_32_1761466577262',
  scanType: 'return',
  base64Length: 37492,
  timestamp: 1761466577264
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 26/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 37492
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_33_1761466577779',
  scanType: 'return',
  base64Length: 37244,
  timestamp: 1761466577782
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"0dj9aKD5MKXoqtsPioqHsAE"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 27/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 37244
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_34_1761466578297',
  scanType: 'return',
  base64Length: 37708,
  timestamp: 1761466578300
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 28/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 37708
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"0tj9aLHNKY6fqtsP7c3P-QY"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_35_1761466578822',
  scanType: 'return',
  base64Length: 38196,
  timestamp: 1761466578824
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 29/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38196
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"09j9aMSeFY2qqtsP-sShmAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_36_1761466579338',
  scanType: 'return',
  base64Length: 38340,
  timestamp: 1761466579339
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 30/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38340
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"09j9aID-KcaCmtkP0cvV-A8"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_37_1761466579855',
  scanType: 'return',
  base64Length: 38216,
  timestamp: 1761466579861
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 31/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38216
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"1Nj9aJ-GDKynqtsPuP2NCA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_38_1761466580372',
  scanType: 'return',
  base64Length: 38452,
  timestamp: 1761466580374
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 32/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38452
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"1Nj9aNilLreMmtkPg5magAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 7,
  frameId: 'frame_39_1761466580887',
  scanType: 'return',
  base64Length: 38268,
  timestamp: 1761466580889
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"1dj9aO_TB--JmtkP0YCwgAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 33/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 38268
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 🧹 Tracking limpiado para scan 7 (1 productos únicos registrados)
[WS] ✅ Return Scan 7 ended
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"1dj9aMmHKN_lqtsP2v-i0Ac"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[WS] ✅ [RETURN] Producto registrado: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 7
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"1tj9aKLzC92VmtkPo8jo-Q8"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"1tj9aKikFt2VmtkPo8jo-Q8"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] User guest disconnected (mVQr44634RGwh_2tAAAN)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (oUR5DpzwqJKLs3ZLAAAP)
[WS] Trolley 123 no existe, usando trolley por defecto
[WS] Operator 456 no existe, usando operator por defecto
[WS] Scan 36 started for trolley 1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_3_1761466642600',
  scanType: 'load',
  base64Length: 79508,
  timestamp: 1761466642603
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 0/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79508
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_4_1761466643121',
  scanType: 'load',
  base64Length: 79900,
  timestamp: 1761466643123
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 1/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79900
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_5_1761466643645',
  scanType: 'load',
  base64Length: 79992,
  timestamp: 1761466643646
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 2/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79992
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_6_1761466644172',
  scanType: 'load',
  base64Length: 79296,
  timestamp: 1761466644174
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 3/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79296
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_7_1761466644700',
  scanType: 'load',
  base64Length: 79376,
  timestamp: 1761466644703
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 4/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79376
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_8_1761466645228',
  scanType: 'load',
  base64Length: 79304,
  timestamp: 1761466645230
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 5/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79304
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_9_1761466645755',
  scanType: 'load',
  base64Length: 79240,
  timestamp: 1761466645757
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.90)
[WS] ✅ Producto 27 marcado como registrado en sesión 36
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.90)
[WS] ✅ Producto 27 marcado como registrado en sesión 36
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 2/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 6/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79240
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_10_1761466646284',
  scanType: 'load',
  base64Length: 78448,
  timestamp: 1761466646286
}
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Takis (confidence: 0.90)
[WS] ✅ Producto 28 marcado como registrado en sesión 36
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Takis (confidence: 0.90)
[WS] ✅ Producto 28 marcado como registrado en sesión 36
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 7/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 78448
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Takis (confidence: 0.90)
[WS] ✅ Producto 28 marcado como registrado en sesión 36
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 36
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 36
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_11_1761466646809',
  scanType: 'load',
  base64Length: 79064,
  timestamp: 1761466646811
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 36
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 8/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79064
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":50,"totalTokenCount":817,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-roboti
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Takis","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Takis","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_12_1761466647325',
  scanType: 'load',
  base64Length: 79280,
  timestamp: 1761466647327
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 9/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79280
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_13_1761466647842',
  scanType: 'load',
  base64Length: 79448,
  timestamp: 1761466647844
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 10/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79448
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_14_1761466648358',
  scanType: 'load',
  base64Length: 79476,
  timestamp: 1761466648361
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 11/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79476
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":50,"totalTokenCount":817,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-roboti
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Takis","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Takis","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_15_1761466648875',
  scanType: 'load',
  base64Length: 79512,
  timestamp: 1761466648877
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 12/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79512
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_16_1761466649389',
  scanType: 'load',
  base64Length: 79472,
  timestamp: 1761466649392
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":50,"totalTokenCount":817,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-roboti
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Takis","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Takis","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 13/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79472
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 36,
  frameId: 'frame_17_1761466649922',
  scanType: 'load',
  base64Length: 79264,
  timestamp: 1761466649925
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 🧹 Tracking limpiado para scan 36 (3 productos únicos registrados)
[WS] Scan 36 ended
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 14/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 79264
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.90)
[WS] ✅ Producto 27 marcado como registrado en sesión 36
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 2/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Takis (confidence: 0.90)
[WS] ✅ Producto 28 marcado como registrado en sesión 36
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Takis (confidence: 0.90)
[WS] ✅ Producto 28 marcado como registrado en sesión 36
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 36
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 36
[Gemini] 📥 Response status: 200
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Takis\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":50,"totalTokenCount":817,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-roboti
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Takis","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Takis","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Takis', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.9},{\"name\":\"Takis\",\"confidence\":0.9},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":48,"totalTokenCount":815,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.9,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.9},{"name":"Takis","confidence":0.9},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.9,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.9 },
    { name: 'Takis', confidence: 0.9 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Takis ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] User guest disconnected (oUR5DpzwqJKLs3ZLAAAP)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (y91h7NRyPa366ZYvAAAR)
[WS] ⚠️ Trolley 123 no existe, creando return scan sin trolleyId
[WS] ⚠️ Operator 456 no existe, creando return scan sin operatorId
[WS] ✅ Return Scan 8 started for original scan 36
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_20_1761466662483',
  scanType: 'return',
  base64Length: 55756,
  timestamp: 1761466662487
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 15/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 55756
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_21_1761466663003',
  scanType: 'return',
  base64Length: 56480,
  timestamp: 1761466663005
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 16/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 56480
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_22_1761466663523',
  scanType: 'return',
  base64Length: 56580,
  timestamp: 1761466663526
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 17/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 56580
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_23_1761466664054',
  scanType: 'return',
  base64Length: 56680,
  timestamp: 1761466664056
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 18/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 56680
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_24_1761466664574',
  scanType: 'return',
  base64Length: 56512,
  timestamp: 1761466664576
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 19/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 56512
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"KNn9aN_G
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] 🆕 Productos NUEVOS a registrar: 2/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_25_1761466665090',
  scanType: 'return',
  base64Length: 55864,
  timestamp: 1761466665091
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] ✅ [RETURN] Producto registrado: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 8
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 20/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 55864
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Kdn9aNOc
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 1/2
[WS] ✅ [RETURN] Producto registrado: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 8
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_26_1761466665605',
  scanType: 'return',
  base64Length: 56668,
  timestamp: 1761466665607
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 21/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 56668
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] ✅ [RETURN] Producto registrado: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 8
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Kdn9aL6q
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_27_1761466666124',
  scanType: 'return',
  base64Length: 56572,
  timestamp: 1761466666128
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Ktn9aILB
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 22/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 56572
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_28_1761466666659',
  scanType: 'return',
  base64Length: 56620,
  timestamp: 1761466666662
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Ktn9aI2t
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 23/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 56620
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"K9n9aJ27
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_29_1761466667171',
  scanType: 'return',
  base64Length: 56672,
  timestamp: 1761466667173
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 24/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 56672
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_30_1761466667697',
  scanType: 'return',
  base64Length: 57212,
  timestamp: 1761466667699
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"K9n9aLeM
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 25/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 57212
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_31_1761466668213',
  scanType: 'return',
  base64Length: 57232,
  timestamp: 1761466668216
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"LNn9aIXM
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 26/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 57232
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_32_1761466668730',
  scanType: 'return',
  base64Length: 57248,
  timestamp: 1761466668733
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 27/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 57248
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Ldn9aI3B
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_33_1761466669262',
  scanType: 'return',
  base64Length: 57088,
  timestamp: 1761466669264
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 28/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 57088
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Ldn9aJnm
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Ldn9aO-G
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_34_1761466669790',
  scanType: 'return',
  base64Length: 57028,
  timestamp: 1761466669791
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 29/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 57028
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Ltn9aNC2
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 8,
  frameId: 'frame_35_1761466670306',
  scanType: 'return',
  base64Length: 57032,
  timestamp: 1761466670308
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 30/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 57032
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 🧹 Tracking limpiado para scan 8 (2 productos únicos registrados)
[WS] ✅ Return Scan 8 ended
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Ltn9aIvb
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] 🆕 Productos NUEVOS a registrar: 2/2
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"L9n9aKTa
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] 🆕 Productos NUEVOS a registrar: 2/2
[WS] ✅ [RETURN] Producto registrado: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 8
[WS] ✅ [RETURN] Producto registrado: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 8
[WS] ✅ [RETURN] Producto registrado: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 8
[WS] ✅ [RETURN] Producto registrado: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 8
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"L9n9aPra
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"MNn9aLOe
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] User guest disconnected (y91h7NRyPa366ZYvAAAR)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (5Ls8nMNN0gvHBOw4AAAT)
[WS] Trolley 123 no existe, usando trolley por defecto
[WS] Operator 456 no existe, usando operator por defecto
[WS] Scan 37 started for trolley 1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_3_1761466700461',
  scanType: 'load',
  base64Length: 29108,
  timestamp: 1761466700463
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 31/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 29108
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_4_1761466700988',
  scanType: 'load',
  base64Length: 28232,
  timestamp: 1761466700990
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 32/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 28232
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_5_1761466701516',
  scanType: 'load',
  base64Length: 27200,
  timestamp: 1761466701518
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 33/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 27200
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_6_1761466702042',
  scanType: 'load',
  base64Length: 29452,
  timestamp: 1761466702044
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 34/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 29452
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_7_1761466702556',
  scanType: 'load',
  base64Length: 33832,
  timestamp: 1761466702559
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 33832
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_8_1761466703072',
  scanType: 'load',
  base64Length: 34312,
  timestamp: 1761466703075
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 34312
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[],\"action\":\"none\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":8,"totalTokenCount":775,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"T9n9aN7_GqHjqtsPl_atEA"}
[Gemini] 📄 Texto extraído: {"items":[],"action":"none"}
[Gemini] 🔍 Parsed result: {"detected":false}
[Gemini] ✅ Detección válida: { detected: false }
[WS] 🔍 Resultado de Gemini: { detected: false }
[WS] ⚪ No se detectó producto o confianza baja
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_9_1761466703599',
  scanType: 'load',
  base64Length: 42580,
  timestamp: 1761466703601
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 42580
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[],\"action\":\"none\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":8,"totalTokenCount":775,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"T9n9aODpOouBqtsPt4KNkAI"}
[Gemini] 📄 Texto extraído: {"items":[],"action":"none"}
[Gemini] 🔍 Parsed result: {"detected":false}
[Gemini] ✅ Detección válida: { detected: false }
[WS] 🔍 Resultado de Gemini: { detected: false }
[WS] ⚪ No se detectó producto o confianza baja
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_10_1761466704121',
  scanType: 'load',
  base64Length: 41620,
  timestamp: 1761466704122
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 41620
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[],\"action\":\"none\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":8,"totalTokenCount":775,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"UNn9aPOjHKrUz7IP6qybmQg"}
[Gemini] 📄 Texto extraído: {"items":[],"action":"none"}
[Gemini] 🔍 Parsed result: {"detected":false}
[Gemini] ✅ Detección válida: { detected: false }
[WS] 🔍 Resultado de Gemini: { detected: false }
[WS] ⚪ No se detectó producto o confianza baja
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"UNn9aIuQJaynqtsPuP2NCA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_11_1761466704644',
  scanType: 'load',
  base64Length: 42008,
  timestamp: 1761466704646
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[],\"action\":\"none\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":8,"totalTokenCount":775,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"UNn9aIOEL6isz7IPh8GskAU"}
[Gemini] 📄 Texto extraído: {"items":[],"action":"none"}
[Gemini] 🔍 Parsed result: {"detected":false}
[Gemini] ✅ Detección válida: { detected: false }
[WS] 🔍 Resultado de Gemini: { detected: false }
[WS] ⚪ No se detectó producto o confianza baja
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 37
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 34/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 42008
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_12_1761466705171',
  scanType: 'load',
  base64Length: 41748,
  timestamp: 1761466705173
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Udn9aPbYDv6tz7IPlZCc8Qs"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 41748
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Udn9aM-oIN2VmtkPo8jo-Q8"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_13_1761466705693',
  scanType: 'load',
  base64Length: 42036,
  timestamp: 1761466705695
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 42036
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Utn9aK6kA4KIqtsP5NO3oAg"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_14_1761466706222',
  scanType: 'load',
  base64Length: 53716,
  timestamp: 1761466706225
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 34/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 53716
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Utn9aNCkJb7oz7IPrtSAeA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_15_1761466706748',
  scanType: 'load',
  base64Length: 63496,
  timestamp: 1761466706750
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 63496
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"U9n9aImtDO-tz7IPiov-yA8"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_16_1761466707272',
  scanType: 'load',
  base64Length: 63688,
  timestamp: 1761466707274
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 34/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 63688
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":24,"totalTokenCount":791,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"U9n9aNy_MJ6lmtkPvoWC6Qo"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Coca-Cola Regular Lata', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_17_1761466707798',
  scanType: 'load',
  base64Length: 63508,
  timestamp: 1761466707800
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 63508
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.85},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"VNn9aOmw
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.85},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.85,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.85},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.85,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.85 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.85,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.85 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 1/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_18_1761466708324',
  scanType: 'load',
  base64Length: 62244,
  timestamp: 1761466708326
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.85)
[WS] ✅ Producto 27 marcado como registrado en sesión 37
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 34/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 62244
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"VNn9aLmK
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_19_1761466708849',
  scanType: 'load',
  base64Length: 62052,
  timestamp: 1761466708850
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 62052
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Vdn9aM3r
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_20_1761466709374',
  scanType: 'load',
  base64Length: 62128,
  timestamp: 1761466709377
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 62128
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Vdn9aL3E
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_21_1761466709900',
  scanType: 'load',
  base64Length: 62804,
  timestamp: 1761466709902
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 62804
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_22_1761466710432',
  scanType: 'load',
  base64Length: 60684,
  timestamp: 1761466710434
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Vtn9aLza
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 60684
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"Vtn9aMzK
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_23_1761466710960',
  scanType: 'load',
  base64Length: 61088,
  timestamp: 1761466710962
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 36/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 61088
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"V9n9aKTZ
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_24_1761466711484',
  scanType: 'load',
  base64Length: 64772,
  timestamp: 1761466711486
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 37/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 64772
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_25_1761466712009',
  scanType: 'load',
  base64Length: 66768,
  timestamp: 1761466712011
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95},{\"name\":\"Doritos Nacho\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"WNn9aKu_
[Gemini] 📄 Texto extraído: {"items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Coca-Cola Regular Lata","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Coca-Cola Regular Lata","confidence":0.95},{"name":"Doritos Nacho","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Coca-Cola Regular Lata',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 },
    { name: 'Doritos Nacho', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 38/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66768
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"WNn9aOiW
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_26_1761466712532',
  scanType: 'load',
  base64Length: 66304,
  timestamp: 1761466712535
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 39/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66304
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":38,"totalTokenCount":805,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"WNn9aKPd
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 2
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/2
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_27_1761466713054',
  scanType: 'load',
  base64Length: 66296,
  timestamp: 1761466713056
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 40/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66296
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_28_1761466713583',
  scanType: 'load',
  base64Length: 66480,
  timestamp: 1761466713585
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 1/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 41/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66480
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 37
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_29_1761466714105',
  scanType: 'load',
  base64Length: 66536,
  timestamp: 1761466714106
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 42/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66536
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_30_1761466714624',
  scanType: 'load',
  base64Length: 66880,
  timestamp: 1761466714627
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 43/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66880
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_31_1761466715138',
  scanType: 'load',
  base64Length: 66388,
  timestamp: 1761466715141
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 44/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66388
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_32_1761466715649',
  scanType: 'load',
  base64Length: 67064,
  timestamp: 1761466715650
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 45/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 67064
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_33_1761466716175',
  scanType: 'load',
  base64Length: 67396,
  timestamp: 1761466716178
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 46/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 67396
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_34_1761466716705',
  scanType: 'load',
  base64Length: 66528,
  timestamp: 1761466716707
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 47/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 66528
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 37,
  frameId: 'frame_35_1761466717223',
  scanType: 'load',
  base64Length: 64420,
  timestamp: 1761466717225
}
[WS] ✅ Load scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 48/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 64420
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] 🧹 Tracking limpiado para scan 37 (3 productos únicos registrados)
[WS] Scan 37 ended
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] 🆕 Productos NUEVOS a registrar: 3/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Doritos Nacho (confidence: 0.95)
[WS] ✅ Producto 27 marcado como registrado en sesión 37
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 2/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 37
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 37
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 37
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] ✅ [LOAD] Producto registrado por PRIMERA VEZ en sesión: Coca-Cola Regular Lata (confidence: 0.95)
[WS] ✅ Producto 9 marcado como registrado en sesión 37
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Doritos Nacho\",\"confidence\":0.95},{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95},{\"name\":\"Coca-Cola Regular Lata\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":51,"totalTokenCount":818,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion
[Gemini] 📄 Texto extraído: {"items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Doritos Nacho","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Doritos Nacho","confidence":0.95},{"name":"Santa Clara Chocolate","confidence":0.95},{"name":"Coca-Cola Regular Lata","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Doritos Nacho',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [
    { name: 'Doritos Nacho', confidence: 0.95 },
    { name: 'Santa Clara Chocolate', confidence: 0.95 },
    { name: 'Coca-Cola Regular Lata', confidence: 0.95 }
  ]
}
[WS] 📦 Items detectados en frame: 3
[WS] ⏭️ Doritos Nacho ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] ⏭️ Coca-Cola Regular Lata ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/3
[WS] User guest disconnected (5Ls8nMNN0gvHBOw4AAAT)
[WS] No token provided, using guest user (dev mode)
[WS] User guest connected (cMvQuCVBB1B5-TSpAAAV)
[WS] ⚠️ Trolley 123 no existe, creando return scan sin trolleyId
[WS] ⚠️ Operator 456 no existe, creando return scan sin operatorId
[WS] ✅ Return Scan 9 started for original scan 37
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_37_1761466731220',
  scanType: 'return',
  base64Length: 32888,
  timestamp: 1761466731221
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 33/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32888
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_38_1761466731737',
  scanType: 'return',
  base64Length: 32592,
  timestamp: 1761466731739
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 34/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32592
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_39_1761466732256',
  scanType: 'return',
  base64Length: 32288,
  timestamp: 1761466732259
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 35/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32288
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_40_1761466732773',
  scanType: 'return',
  base64Length: 32140,
  timestamp: 1761466732777
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 36/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32140
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_41_1761466733287',
  scanType: 'return',
  base64Length: 32440,
  timestamp: 1761466733290
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"bdn9aOvMFaLiqtsPhZ2F-AY"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 37/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32440
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] ✅ [RETURN] Producto registrado: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 9
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"bdn9aK-pMJCKmtkPlryVoAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_42_1761466733803',
  scanType: 'return',
  base64Length: 32512,
  timestamp: 1761466733805
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 38/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32512
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_43_1761466734322',
  scanType: 'return',
  base64Length: 32612,
  timestamp: 1761466734323
}
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"btn9aPWZF-SyqtsPnZLGCQ"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 39/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32612
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_44_1761466734848',
  scanType: 'return',
  base64Length: 32640,
  timestamp: 1761466734850
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 40/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32640
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"b9n9aJTFBp6J6dkP842j-AI"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"b9n9aOqnDPeDmtkP2dGviAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_45_1761466735374',
  scanType: 'return',
  base64Length: 32796,
  timestamp: 1761466735376
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"b9n9aKDmJPCsmtkPmMVV"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 41/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32796
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_46_1761466735898',
  scanType: 'return',
  base64Length: 32664,
  timestamp: 1761466735900
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 42/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32664
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 📥 Frame recibido del cliente
[WS] 📊 Datos del frame: {
  scanId: 9,
  frameId: 'frame_47_1761466736424',
  scanType: 'return',
  base64Length: 32660,
  timestamp: 1761466736425
}
[WS] ✅ Return scan válido, obteniendo catálogo...
[WS] 📦 Productos en catálogo: 20
[WS] 📊 Rate actual: 43/120 RPM
[WS] 🤖 Llamando a Gemini para análisis...
[Gemini] 🚀 Iniciando análisis con Gemini API
[Gemini] 📦 Catálogo: 20 productos
[Gemini] 📊 Base64 length: 32660
[Gemini] 📝 Prompt generado: Detecta SOLO productos que VES en la imagen. Catálogo:
Coca-Cola Regular Lata: Lata roja, anilla roja, logo "Coca-Cola" blanco
Coca-Cola Light Lata: Lata plateada/gris, aro rojo, texto "Light"
Coca-Co...
[Gemini] 📡 Enviando request a: https://generativelanguage.googleapis.com/v1beta/models/gemini-robotics-er-1.5-preview:generateContent
[WS] 🧹 Tracking limpiado para scan 9 (1 productos únicos registrados)
[WS] ✅ Return Scan 9 ended
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"cNn9aJnyPMqmmtkPxaDKsAs"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"cdn9aNekAqPnqtsPjcGPuAg"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"cdn9aIvHE_eDmtkP2dGviAc"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] 🆕 Productos NUEVOS a registrar: 1/1
[WS] ✅ [RETURN] Producto registrado: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 9
[WS] ✅ [RETURN] Producto registrado: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 9
[WS] ✅ [RETURN] Producto registrado: Santa Clara Chocolate (confidence: 0.95)
[WS] ✅ Producto 23 marcado como registrado en sesión 9
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"cdn9aNO8MubwqtsPrs-oyAE"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
[Gemini] 📥 Response status: 200
[Gemini] 📦 JSON response: {"candidates":[{"content":{"parts":[{"text":"{\"items\":[{\"name\":\"Santa Clara Chocolate\",\"confidence\":0.95}],\"action\":\"placing\"}"}],"role":"model"},"finishReason":"STOP","index":0}],"usageMetadata":{"promptTokenCount":767,"candidatesTokenCount":22,"totalTokenCount":789,"promptTokensDetails":[{"modality":"TEXT","tokenCount":509},{"modality":"IMAGE","tokenCount":258}]},"modelVersion":"gemini-robotics-er-1.5-preview","responseId":"ctn9aIbyFde2qtsPsMWrCA"}
[Gemini] 📄 Texto extraído: {"items":[{"name":"Santa Clara Chocolate","confidence":0.95}],"action":"placing"}
[Gemini] 🔍 Parsed result: {"detected":true,"product_name":"Santa Clara Chocolate","confidence":0.95,"action":"placing_in_trolley","all_items":[{"name":"Santa Clara Chocolate","confidence":0.95}]}
[Gemini] ✅ Detección válida: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 🔍 Resultado de Gemini: {
  detected: true,
  product_name: 'Santa Clara Chocolate',
  confidence: 0.95,
  action: 'placing_in_trolley',
  all_items: [ { name: 'Santa Clara Chocolate', confidence: 0.95 } ]
}
[WS] 📦 Items detectados en frame: 1
[WS] ⏭️ Santa Clara Chocolate ya fue registrado en esta sesión - Se omite
[WS] 🆕 Productos NUEVOS a registrar: 0/1
